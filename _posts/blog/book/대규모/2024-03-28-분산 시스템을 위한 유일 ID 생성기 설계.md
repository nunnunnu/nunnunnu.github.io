---
title: "[가상 면접 사례로 배우는 대규모 시스템 설계 기초] 7장 분산 시스템을 위한 유일 ID 생성기 설계"
category: 프로그래밍 방법
tags:
  - 설계
  - 가상면접사례로배우는대규모시스템설계기초
  - 책요약
last_modified_at: 2024-03-28
---

[책정보](https://m.yes24.com/Goods/Detail/102819435)
![images](/assets/images/대규모/IMG-20240910172136.png)

> [!NOTE]
> auto_increment 속성이 설정된 관계형데이터베이스의 기본키를 쓰면 되지않나? -> 데이터베이스 서버 여러대일때는 불가능함

선택지로는 다중마스터 복제, UUID, 티켓 서버, 트위터 스노플레이크 접근법 등이 있음
#### 다중 마스터 복제(multi-master replication)
DB의 auto_increment 기능을 활용하나 **다음 ID의 값을 구할때 +1하는것이 아니라 현재 사용중인 데이터베이스 서버의 수만큼 증가**시키는 방법
규모확장성 문제를 어느정도 해결가능하며 데이터베이스의 수가 늘어나면 초당 생산가능한 ID수도 늘어나지만 여러 데이터센터에 걸쳐 규모를 늘리기 어렵다는 점과 시간흐름에 맞춰 ID가 커짐을 보장할 수 없고 서버 추가/삭제 시에 잘 동작하게 만들기 어렵다는 단점이있음
#### UUID
웹 서버에서 UUID를 생성하는 방법으로 간단하며 서버사이 조율이 필요없어 동기화이슈도 없고 규모확장에도 유리하나 ID가 길다는것과 시간순 정렬이 불가능하다는점, ID에 숫자아닌값이 저장될 수 있다는 문제가 있음
중복UUID문제는 지극히 낮음
#### 티켓 서버
유일성이 보장되는 ID를 만들어내는 데이터베이스 서버를 하나 만드는 것.
유일성이보장되는 오직 숫자로만 구성된 ID를 쉽게 만들 수 있고 구현하기 쉬우며 중소 어플리케이션에 적합하다.
그러나 티켓서버가 SPOF이 되며 이를 피하기위해 티켓서버를 여러대 준비하면 동기화 문제가 발생함
#### 트위터 스노플레이크 접근법

각개 격파 전략 : 생성해야 하는 ID의 구조를 여러절로 분할
- ex. 타임스탬프 + 데이터센터ID + 서버ID + 일련번호
	- 데이터센터ID와 서버ID는 시스템운영중에 바뀌지않음(만약 바꾼다고해도 충돌가능성이 커서 아주 신중해야함)
	- 타임스탬프 - 타임스탬프로 표현 가능한 시간은 69년. 기원전을 현재시간에 가깝게맞추면 오버플로우 발생 시점을 늦출 수 있음. 69년이 지나면 기원시간을 바꾸거나 ID체계를 다른것으로 마이그레이션해야함
	- 일련번호 - 어떤 서버가 같은 밀리초동안 하나이상의 ID를 만들어낸 경우에만 0보다 큰 값을 가짐
