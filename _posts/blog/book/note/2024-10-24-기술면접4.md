---
title: "[개발자를 위한 코딩테스트] 기술면접 4"
category: CS
tags:
  - cs
  - 책요약
last_modified_at: 2024-10-30
---

##### 아키텍쳐 개선

**MSA**

하나의 애플리케이션을 여러 작은 애플리케이션으로 쪼개어 서비스를 연결하는 개념의 분산 아키텍쳐
주로 업무별, 비지니스의 기능단위로 분리, 서비스결합도를 낮추고 연관 서비스간의 통신으로 클라이언트의 요청을 처리. 기능단위 배포가능, 서비스 결합도 낮춤

API 성격에맞게 구조화를 추구하거나 업무 단위별로 모듈을 설계하면 가벼운 모듈 단위로 빌드/배포를 수시로 가능

즉, MSA로 가기까지의 부담이 줄어들고 가급적 적은 인원으로 적은 프로젝트를 유지시킬수있음

인증이나 접근 키 관리 등을 해주어야하는 번거로움 존재, 내부(Internal 혹은 Server to Server)/외부 통신(External 혹은 Client to Server) 모듈도 각각 구분지어주어야함 -> 구조 복잡도 증가

부하분산을 위한 중간레벨의 작은 규모 API 게이트웨이 정도(로깅, 인증, 인가 정도만 구현한)로 분산을 시킬수도있음

조직의 비지니스 상황에맞게 된다면 기능단위의 레이어로 본연의 기능들을 분리하고 배포를 용이하게 만드는 방향으로 준비하는게 초기 설계로 바람직하다

비즈니스 스케일에따라 업무나 비즈니스의 분리부터 시작해 물리적 서버분리 형태로 갈수있고 클라우드 환경을 지향한다면 기능단위의 세분화된 서버 아키텍처와 설정환경 분리, 서비스 디스커버리와같은 형태로 복잡하고 거대한 서비스 가능

- 장점
	- 도메인 서비스 별 독립적 구조로 개발 가능
	- 독립적 구조로 스케일이 작다보니 변경이 용이하고 빌드/테스트 단위가 작아짐
	- 특정 서비스만 스케일 아웃 가능
	- 생산성을 높이고 빠르게 변화하는 환경에 효과적
	- 서비스 별 특성에 맞는 언어/리소스를 구성
	- 트래픽이 급증하는 서비스에 적합
- 단점
	- 데이터 비정규화를 통해 API 호출 횟수를 줄이려는 경향이 있어 좀더 많은 데이터/디스크/중복코드 발생
	- 통합테스트 어려움
	- 데이터 조립해 뷰를 제공하는 방식이 모놀리스보다 훨씬 복잡
	- 기본적으로 메서드 호출방식의 모놀리식에 비해 HTTP 통신을 통해 서비스를 제공하다보니 Network I/O비용이 발생
	  그러나 성능이 좋은 하드웨어와 트래픽이 몰릴때 유연한 확장성, 캐싱 등 속도문제를 해결할 다양한 옵션 존재
	- 모놀리스에 비해 더 많은 부가 기술과 리소스가 필요
	- 트랜젝션 불편
	- 관리 포인트가 늘어남
	- 개발인력 더 필요

MSA를 구축할때 <mark class="hltr-cyan">가장 경계해야하는 지점은 인력과 기술의 오버 엔지니어링</mark>임. 잘못했다간 회사가 감당하지 못할 인력이 필요하게됨

기술도입 검토 단계에서 기술의 적합성, 도입 가능성을 보수적으로 판단하지 않으면 기술도 인력도 오버되는 상황이 발생하니 잘 판단해야함

MSA를 도입한다면 서킷브레이커, 이벤트 드리븐, 스키마 변경, 분산 트랜잭션, 서비스 디스커버리 등 적용할것이많아 피로도가 높아짐

적정수준의 경계를 긋도 이를 근거로 도메인이나 스킬셋을 적용해야함. (커머스 - 회원만 별도 분리 or 주문과 배송, 회원 상품정보만 분리)

따라서 전환하기어렵다면 이전에 언급한

![image](/assets/images/note/IMG-20250521163501.png)

이 구조를 검토해봐도 좋을것.

웹 서버 레벨에서 리버스 프록시를 통한 엔드리포인트를 일원화 + 업무단위 모듈로 API 서버군을 두고 비동기 아키텍처나 캐싱정도의 별도 서버를 구동하면 MSA로 가기 전 모놀라식 문제를 대부분 해소 가능

##### 스케일 아웃과 스케일 업
>![문제 11]
>
>서버 증설 시 어떠한 기준을 가지고 수평 확장, 수직 확장을 고려할지?

클라우드 환경으로 넘어가면서 필요에따라 서버를 늘리거나 줄임. 또는 고성능 처리를 위해 서버를 별도의 아키텍처로 구성하는것을 수평확장과 수직확장이라 부름

- 수평 확장(스케일 아웃)
  
	서버의 대수를 늘려 처리량 향상. 보통 클라우드환경에서 트래픽이 몰리는 경우를 대비해 애플리케이션 서버들을 필요에따라 늘리거나 줄일 수 있음. 트래픽을 분산함으로 시스템의 처리량을 향상
	
	서버부하가 지속적으로 높거나 일시적 트래픽이 늘어남이 예상될경우 AWS는 운영시점에 정의한 임계치설정에따라 EC2인스턴스 수를 자동으로 증가, 감소 가능
	
	그러나 적은 규모에 비해 세션관리/데이터정합성 처리가 복잡할 수 있고 비용이 추가될수있음
	
- 수직 확장(스케일 업)
  
	서버의 사양을 높여 성능을 확장시킴. 보통 DB의 경우 스케일아웃보단 스케일 업을 시도해 운영함
	
	단일 트랜잭션 비지니스 로직이 매우 복잡하거나 대량의 데이터 처리가 필요하고 통계, 집계 배치 등의 프로세스가 주 업무라면 시도해볼 수 있음
	
	지속적으로 CPU사용량이 60프로를 초과하고 메모리도 60프로를 초과하면 스케일 업을 시도
	
	리소스 한계가있으나 스케일아웃보다는 관리가 용이함. 단, 교체시점에 다운타임에대한 대비책 필요	

---
##### API 설계
>![문제 12]
>
>API 설계 시 필요한 원칙, 지원자가 API를 작성할 때 중요하게 생각하는 요소

REST는 URI로 지정한 리소스에대한 조작을 통일하고 한정적 인터페이스로 수행하는 아키텍쳐 스타일로 URI로 표현된 리소스와 HTTP(GET, PUT...) 서비스를 통해 자원에 대한 행위를 요청

요청 뒤 내용을 Json으로 응답

API디자인의 모범사례는 [REST API Turotial](https://restfulapi.net/resource-naming/), 애피지에서 발표한 [Web API Design - Crafting Interfaces that Developers Loves](https://cloud.google.com/apigee?hl=ko)에서 살펴볼 수 있음

- API 디자인 시 지켜야 할 원칙 10가지
	- URL 룰
	  계층표현은 /로 표현하되 마지막에는 사용x
	- 언더바(_) 대신 대시(-) 사용: 대시는 단어의 결합으로 인한 정확한 표현이 불가피할때 사용함
	- 소문자 사용
	- 단순하고 간단한 구조로 작성: 한 리소스에대해 단 두개의 접근 URL을 제공(복수와 단수) -> 멱등성 보장(같은 주소 호출 시 같은 데이터 출력 보장)
	- URL에 HTTP 메소드 노출x: 파일 확장자를 URI에 사용x, 동사나 동사구를 사용
	- 리소스 URI에 항목/컬렉션보다 더 깊은 depth를 가지지 않도록함: 불가피할때는 최대 4depth까지 허용
	- 의미에맞는 HTTP 상태를 반환
	- API 버전 명시: 상위버전은 하위버전의 하위호환성을 유지해야함. API는 변경이 잦기때문에 클라이언트에 미치는 영향을 고려해야함
	- 리소스에 대한 정렬, 필드에 대한 필터, 페이징은 쿼리 파라미터를 활용
	- 문서로 자세히 정리되어있어야함

---

>![문제 13]
>
>- CI/CD가 가져야할 특징, 기능에대해 설명. 본인이 전사에 사용할 공통 CI/CD 솔루션을 만든다고 가정할때 어떤기능을 넣을지 프로세스 단위로 설명해주세요
>
>- 애플리케이션의 다운타임을 최소화하기 위해 기본적인 배포방식을 설명해주세요

배포시스템은 CI(지속적 통합)/CD(지속적 배포)로 나눌 수 있음.

현재는 클라우드 인프라를 많이 사용하는데 쿠버네티스와 도커(최근 많이 사용)를 이용하거나 오픈소스 배포 솔루션을 도입하는 등 배포방식의 트랜드가 많이 바뀜.

- CI/DC
  
	데브옵스라는 말이 나오기 전 ALM이라는 관점에서 빌드 및 테스트 자동화 단계를 확장한 의미.
	
	물론 그 전부터 있었을  수 있고 누군가는 ALM과 비슷하지만 분명 다른개념이라 주장할 수 있음.
	
	깃허브가 많이 사용되기 전부터 CI개념은 존재했고 CI, CD는 개념상 분리한것이지 연관이 깊음
	
	- CI: 개발자들이 각 소스들을 메인소스에 병합하고 빌드하는 과정이 반복되는것을 자동화할 필요성을 느끼고 등장함. 소스를 항상 배포가능하게 관리할 필요가있음
	  
	  병합 -> 자동 테스트 -> 코드품질을 보고서로 작성 -> 생산성 증가
	  
	  이 과정을 통해 최종 프로덕트 코드를 여러 서버에 업로드함. 
	  
	- CD: 지속적으로 업데이트 사항 배포를 자동화하기 위한 기술적 개념을 

- 배포방식
	- Rolling Update
	  
	  서비스 중인 인스턴스 그룹 내 하나씩 트레픽을 차단해 새 빌드 버전으로 교체.
	  
	  새 버전이 배포되면 LB가 다시 연결되고 서비스가 활성화됨
	  
	  관리가 편하고 추가 서버비용을 발생시키지 않음.
	  
	  다만, 배포시점에는 빌드버전이 달라 사용자에게 어떤 버전이 보일지 알 수 없고 서버가 많아질수록 배포시간 증가. 일반적인방식이나 좋은방식은 아님
	  
	  => 배포 소스의 규모를 작게 나누는 MSA나 트래픽이 몰리지않는 시간대에 배포를 진행함
	  
	- Blue/Green
	  
	 대형 환경에서 선호됨.
	 
	 ![image](IMG-20250521163501-1.png)
 
	Old version이 운영중인 서버, New version이 배포할 신 서버. 
	
	구버전과 동일하게 신버전 인스턴스 그룹을 생성한 후 LB를 통해 신버전으로 트래필을 돌리는 작업을 함.
	
	장점은 신버전 배포 후 문제가 있을때 LB만 원위치 시키면 되므로 롤백이 빠르고 운영환경에 영향없이 새버전을 올릴 수 있음
	
	다만, db를 제외해도 시스템 자원이 2배로 필요함
	
	또한 새 버전 배포가 나갈때 반드시 QA를 통해 버그나 장애 유발 가능성을 낮춰야함
	
	- Canary
	  
	  대형 환경에서 선호됨
	  
	  ![image](/assets/images/note/IMG-20250521163501-2.png)
	  
	새 버전을 소수의 사용자에게 점진적 오픈 -> 모니터링으로 문제 파악 -> 모든 사용자에게 오픈(이전 인스턴스 삭제 - 자원 절약)
	
	분산환경에서 클라우드 인스턴스 서비스를 이용한다면 블루/그린보다 안전하다
	
	쉽게 사용자들에게 A/B테스트를 수행 가능
	
	기본적인 방식이며 실제로는 더 다양한 기능이 제공되어야 자동화라 할수있음

- 배포 프로세스에 필요한 것
	카나리 방식으로 배포한다고 가정하고 시나리오를 가정해보자
	1. 새로운 버전의 변경 커밋 -> 리뷰 -> 머지
	2. 새로운 버전 빌드. 배포 담당자는 배포시스템에 실수로 배포버튼을 누르지못하게 락을 걸어둠
	3. 카나리 배포 방식으로 일정 비율의 서버에 새로운 버전을 빌드, 테스트 수행
	4. 카나리에 문제가 없다면 타깃 서버에 새로운 버전 배포
		- 각 팀의 배포도구를 이용해 빌드이력은 배포이력 시스템 api를 호출하여 남김(배포시간, 배포한사람). API가 아니고 로그를 적재하는 형태만이라도 이력은 자동으로 남아야함
		- 기존버전의 인스턴스가 죽기 전 모든 연결을 정리. 새 인스턴스 요청이 들어와야함
		- 빠른 롤백을 보장하는 배포방식(롤백을 위해 재빌드되면 안됨)
	5. 배포 완료가 자동 공유됨: 배포 시스템에 등록된 notification을 통해 배포 진행상황을 알수있어야하고 결과가 알림으로 와야함
	6. 자동으로 배포 히스토리 기록, 릴리즈 버전 태그 생성. 이슈가 있을 시 관련 로그와 함께 파악 가능하도록 대시보드가 지원되어야함
	7. 전체 모니터링 후 배포 프로세스 종료
	   
	모니터링 지표들은 한곳에 모아 관리되어야함. (health check, server resource(CPU, memory, disk), metric 수집, 로깅 파일 분석 툴 등)
	
	![image](/assets/images/note/IMG-20250521163501-3.png)
	
	머지 -> CI도구를 통한 배포 시도(배포이력 남음) -> 권한 가진 유저가 체크인 시 자동/수동으로 프로세스 실행 -> 테스트 결과에 문제 x -> 단계별로 dev, stage, product 소스들이 배포 -> product가 카나리 방식으로 지정된 비율대로 라우팅됨 -> 에러발생 시 이전버전으로 롤백

	테스트 단계에서 Phase 별로 Hotfix버전이 수동배포로 진행될수 있도록 매뉴얼 배포 기능이 제공될 수 있음
	
	최근에는 MSA환경의 배포솔루션이 다양하게 지원되고있고 AWS나 쿠버네티스같은 컨테이너 아키텍처에서의 배포방식은 물리서버 기반의 배포와는 기술적으로 CI/CD 파이프라인을 구축하며 ArgoCD, foCD같은 제품군도 이음
	