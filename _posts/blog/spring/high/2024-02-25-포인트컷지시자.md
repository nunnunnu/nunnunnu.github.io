---
title: "[ê¹€ì˜í•œ ìŠ¤í”„ë§ í•µì‹¬ì›ë¦¬ - ê³ ê¸‰] í¬ì¸íŠ¸ ì»· ì§€ì‹œì"
category: Spring
tags:
  - spring
  - ê¹€ì˜í•œìŠ¤í”„ë§í•µì‹¬ì›ë¦¬-ê³ ê¸‰
  - í¬ì¸íŠ¸ì»·
ìƒì„±ì¼: 2024-02-25
last_modified_at: 2024-02-25
---
ì—ìŠ¤íŒ©íŠ¸Jê°€ ì œê³µí•˜ëŠ” í¬ì¸íŠ¸ì»· í‘œí˜„ì‹(pointcut expression)ì„ í¬ì¸íŠ¸ì»· í‘œí˜„ì‹ì´ë¼ê³  ë¶€ë¥¸ë‹¤.

í¬ì¸íŠ¸ì»· í‘œí˜„ì‹ì€ executionê°™ì€ í¬ì¸íŠ¸ì»· ì§€ì‹œì(pointcut Designator)ë¡œ ì‹œì‘ í•´ PCDë¼ ë¶€ë¥¸ë‹¤

- í¬ì¸íŠ¸ì»· ì§€ì‹œì(pointcut Designator)
    - execution : ë©”ì†Œë“œ ì‹¤í–‰ ì¡°ì¸ í¬ì¸íŠ¸ ë§¤ì¹­, ìŠ¤í”„ë§ AOPì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ê³  ê¸°ëŠ¥ë„ ë³µì¡
    - within : íŠ¹ì • íƒ€ì…ë‚´ ì¡°ì¸í¬ì¸íŠ¸ë¥¼ ë§¤ì¹­
    - args : ì¸ìê°€ ì£¼ì–´ì§„ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ ì¡°ì¸í¬ì¸íŠ¸
    - this : ìŠ¤í”„ë§ ë¹ˆ ê°ì²´(ìŠ¤í”„ë§ AOP í”„ë¡ì‹œ)ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì¡°ì¸í¬ì¸íŠ¸)
    - target : Targetê°ì²´(ìŠ¤í”„ë§AOPê°€ ê°€ë¥´í‚¤ëŠ” ì‹¤ì œëŒ€ìƒ)ë¥¼ ëŒ€ìƒìœ¼ë¡œí•˜ëŠ” ì¡°ì¸í¬ì¸íŠ¸
    - @target : ì‹¤í–‰ ê°ì²´ì˜ í´ë˜ìŠ¤ì— ì£¼ì–´ì§„ íƒ€ì…ì˜ ì–´ë…¸íŠ¸ì—ì…˜ì´ìˆëŠ” ì¡°ì¸íŠ¸ë¥¼ ë§¤ì¹­
    - @within: ì£¼ì–´ì§„ ì–´ë…¸í…Œì´ì…˜ì´ìˆëŠ” íƒ€ì… ë‚´ ì¡°ì¸í¬ì¸íŠ¸
    - @annotation : ë©”ì„œë“œê°€ ì£¼ì–´ì§„ ì–´ë…¸í…Œì´ì…˜ì„ ê°€ì§€ê³ ì‡ëŠ” ì¡°ì¸í¬ì¸íŠ¸ë¥¼ ë§¤ì¹­
    - @args : ì „ë‹¬ëœ ì‹¤ì œì¸ìˆ˜ì˜ ëŸ°íƒ€ì„ íƒ€ì…ì´ ì£¼ì–´ì§„ íƒ€ì…ì˜ ì–´ë…¸í…Œì´ì…˜ì„ ê°–ëŠ” ì¡°ì¸í¬ì¸íŠ¸
    - bean : ìŠ¤í”„ë§ ì „ìš© í¬ì¸íŠ¸ì»· ì§€ì‹œì, ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ í¬ì¸íŠ¸ì»·ì„ ì§€ì •
- ê¸°ë³¸ êµ¬ì¡°
    
    ```java
    package hello.aop.member.annotation;
    
    import java.lang.annotation.ElementType;
    import java.lang.annotation.Retention;
    import java.lang.annotation.RetentionPolicy;
    import java.lang.annotation.Target;
    
    @Target(ElementType.METHOD)
    @Retention(RetentionPolicy.RUNTIME)
    public @interface MethodAop {
    	String value();
    }
    
    ```
    
    ```java
    package hello.aop.member.annotation;
    
    import java.lang.annotation.ElementType;
    import java.lang.annotation.Retention;
    import java.lang.annotation.RetentionPolicy;
    import java.lang.annotation.Target;
    
    @Target(ElementType.TYPE)
    @Retention(RetentionPolicy.RUNTIME)
    public @interface ClassAop {
    
    }
    
    ```
    
    ```java
    package hello.aop.member;
    
    public interface MemberService {
    	public String hello(String param);
    }
    
    ```
    
    ```java
    package hello.aop.member;
    
    import hello.aop.member.annotation.MethodAop;
    
    public class MemberServiceImpl implements MemberService {
    	@Override
    	@MethodAop("test value")
    	public String hello(String param) {
    		return "OK";
    	}
    
    	public String internal(String param) {
    		return "OK";
    	}
    }
    
    ```
    
    ```java
    package hello.aop.pointcut;
    
    import java.lang.reflect.Method;
    
    import org.junit.jupiter.api.BeforeEach;
    import org.junit.jupiter.api.Test;
    import org.springframework.aop.aspectj.AspectJExpressionPointcut;
    
    import hello.aop.member.MemberServiceImpl;
    import lombok.extern.slf4j.Slf4j;
    
    @Slf4j
    public class ExecutionTest {
    	AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
    	Method helloMethod;
    
    	@BeforeEach
    	public void init() throws NoSuchMethodException {
    		helloMethod = MemberServiceImpl.class.getMethod("hello", String.class);
    	}
    
    	@Test
    	void printMethod() {
    		//helloMethod=public java.lang.String hello.aop.member.MemberServiceImpl.hello(java.lang.String)
    		log.info("helloMethod={}", helloMethod);
    	}
    }
    
    ```
    

### execution

```java
package hello.aop.pointcut;

import static org.assertj.core.api.Assertions.*;

import java.lang.reflect.Method;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.aop.aspectj.AspectJExpressionPointcut;

import hello.aop.member.MemberServiceImpl;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class ExecutionTest {
	AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
	Method helloMethod;

	@BeforeEach
	public void init() throws NoSuchMethodException {
		helloMethod = MemberServiceImpl.class.getMethod("hello", String.class);
	}

	@Test
	void printMethod() {
		//helloMethod=public java.lang.String hello.aop.member.MemberServiceImpl.hello(java.lang.String)
		log.info("helloMethod={}", helloMethod);
	}

	@Test
	void exactMatch() {
		pointcut.setExpression("execution(public String hello.aop.member.MemberServiceImpl.hello(String))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();

	}

	//ê°€ì¥ë§ì´ ìƒëµí•œ í¬ì¸íŠ¸ì»·
	@Test
	void allMatch() {
		pointcut.setExpression("execution(* *(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();

	}

	@Test
	void nameMatch() {
		pointcut.setExpression("execution(* hello(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void nameMatchStar1() {
		pointcut.setExpression("execution(* hell*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void nameMatchStar2() {
		pointcut.setExpression("execution(* *ll*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void packageExactMethod1() {
		pointcut.setExpression("execution(* hello.aop.member.MemberServiceImpl.hello(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void packageExactMethod2() {
		pointcut.setExpression("execution(* hello.aop.member.*.*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void packageExactFalse() {
		pointcut.setExpression("execution(* hello.aop.*.*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isFalse();
	}

	@Test
	void packageExactSubPackage1() {
		pointcut.setExpression("execution(* hello.aop..*.*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void typeExactMatch() {
		pointcut.setExpression("execution(* hello.aop.member.MemberServiceImpl.*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void typeExactMatchSuperType() {
		pointcut.setExpression("execution(* hello.aop.member.MemberService.*(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void typeMatchNoMatchSuperTypeMethodFalse() throws NoSuchMethodException {
		pointcut.setExpression("execution(* hello.aop.member.MemberService.*(..))");
		Method internal = MemberServiceImpl.class.getMethod("internal", String.class);
		assertThat(pointcut.matches(internal, MemberServiceImpl.class)).isFalse(); //ìì‹ì—ëŠ” ìˆì–´ë„ ë¶€ëª¨ í´ë˜ìŠ¤ì—ì—†ëŠ” ë©”ì†Œë“œëŠ” ë¶ˆê°€ëŠ¥
	}

	@Test
	void typeMatchInternal() throws NoSuchMethodException {
		pointcut.setExpression("execution(* hello.aop.member.MemberServiceImpl.*(..))");
		Method internal = MemberServiceImpl.class.getMethod("internal", String.class);
		assertThat(pointcut.matches(internal, MemberServiceImpl.class)).isTrue(); //ìì‹ì—ëŠ” ìˆì–´ë„ ë¶€ëª¨ í´ë˜ìŠ¤ì—ì—†ëŠ” ë©”ì†Œë“œëŠ” ë¶ˆê°€ëŠ¥
	}

	//Stringíƒ€ì…ì˜ íŒŒë¼ë¯¸í„°
	@Test
	void argsMatch() {
		pointcut.setExpression("execution(* *(String))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	//íŒŒë¼ë¯¸í„°ì—†ìŒ
	@Test
	void argsMatchNoArgs() {
		pointcut.setExpression("execution(* *())");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isFalse();
	}

	//íŒŒë¼ë¯¸í„°ê°€ í•˜ë‚˜ ìˆìœ¼ë‚˜ ëª¨ë“  íƒ€ì… í—ˆìš©
	@Test
	void argsMatchStar() {
		pointcut.setExpression("execution(* *(*))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	//íŒŒë¼ë¯¸í„° ê°¯ìˆ˜ì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  íŒŒë¼ë¯¸í„°, ëª¨ë“  íƒ€ì… í—ˆìš©
	//ì—†ìŒ, í•˜ë‚˜ìˆìŒ, ì—¬ëŸ¬ê°œìˆìŒ ëª¨ë‘ í—ˆìš©
	@Test
	void argsMatchAll() {
		pointcut.setExpression("execution(* *(..))");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	//ì²« íŒŒë¼ë¯¸í„°ê°€ Stringì´ì—¬ì•¼í•¨(ê°¯ìˆ˜ì œí•œX)
	@Test
	void argsMatchString() {
		pointcut.setExpression("execution(* *(String, ..))");
		//ê°¯ìˆ˜ì œí•œ ë‘ë ¤ë©´ *ë¡œí•´ì•¼í•¨
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}
}

```

### within

```java
package hello.aop.pointcut;

import static org.assertj.core.api.Assertions.*;

import java.lang.reflect.Method;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.aop.aspectj.AspectJExpressionPointcut;

import hello.aop.member.MemberServiceImpl;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class WithinTest {
	AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
	Method helloMethod;

	@BeforeEach
	public void init() throws NoSuchMethodException {
		helloMethod = MemberServiceImpl.class.getMethod("hello", String.class);
	}

	@Test
	void printMethod() {
		//helloMethod=public java.lang.String hello.aop.member.MemberServiceImpl.hello(java.lang.String)
		log.info("helloMethod={}", helloMethod);
	}

	@Test
	void withinMatch() {
		pointcut.setExpression("within(hello.aop.member.MemberServiceImpl)");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();

	}

	@Test
	void nameMatchStar1() {
		pointcut.setExpression("within(hello.aop.member.*Service*)");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	void withinSubPackage() {
		pointcut.setExpression("within(hello.aop..*)");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	@Test
	@DisplayName("íƒ€ì¼“ì˜ íƒ€ì…ì—ë§Œ ì§ì ‘ ì ìš©, ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„ ì •í•˜ë©´ ì•ˆë¨")
	void withinSuperTypeFalse() {
		pointcut.setExpression("within(hello.aop.member.MemberService)");
		assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isFalse();
	}
}

```

executionê³¼ëŠ” ë‹¤ë¥´ê²Œ ë¶€ëª¨í´ë˜ìŠ¤ë¥¼ ì„ ì–¸í•´ì„œ ìì‹í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. executionë³´ë‹¤ëŠ” ì œì•½ì´ìˆì–´ì„œ ì‹¤ë¬´ì—ì„œëŠ” ì˜ ì‚¬ìš©í•˜ì§€ì•ŠëŠ”ë‹¤

### within

```java
package hello.aop.pointcut;

import static org.assertj.core.api.Assertions.*;

import java.lang.reflect.Member;
import java.lang.reflect.Method;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.aop.aspectj.AspectJExpressionPointcut;

import hello.aop.member.MemberServiceImpl;

public class ArgsTest {
	Method helloMethod;

	@BeforeEach
	public void init() throws NoSuchMethodException {
		helloMethod = MemberServiceImpl.class.getMethod("hello", String.class);
	}

	private AspectJExpressionPointcut pointcut(String expression) {
		AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
		pointcut.setExpression(expression);
		return pointcut;
	}

	@Test
	void args() {
		//hello(String)
		assertThat(pointcut("args(String)").matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut("args(Object)").matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut("args()").matches(helloMethod, MemberServiceImpl.class)).isFalse();
		assertThat(pointcut("args(..)").matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut("args(*)").matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut("args(String,..)").matches(helloMethod, MemberServiceImpl.class)).isTrue();
	}

	//execution(* *(java.io.Serializable)): ë©”ì„œë“œì˜ ì‹œê·¸ë‹ˆì²˜ë¡œ íŒë‹¨(ì •ì )
	//args(java.io.Serializable):ëŸ°íƒ€ì„ì— ì „ë‹¬ëœ ì¸ìˆ˜ë¡œ íŒë‹¨(ë™ì )
	@Test
	void argsVsExecution() {
		//Args
		assertThat(pointcut(("args(String)")).matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut(("args(java.io.Serializable)")).matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut(("args(Object)")).matches(helloMethod, MemberServiceImpl.class)).isTrue();

		//execution
		assertThat(pointcut(("execution(* *(String))")).matches(helloMethod, MemberServiceImpl.class)).isTrue();
		assertThat(pointcut(("execution(* *(java.io.Serializable))")).matches(helloMethod, MemberServiceImpl.class)).isFalse();
		assertThat(pointcut(("execution(* *(Object))")).matches(helloMethod, MemberServiceImpl.class)).isFalse();

	}
}

```

executionë³´ë‹¤ ë™ì ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë§¤í•‘ì´ í¸ë¦¬í•œê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ. ê·¸ëŸ¬ë‚˜ ì‹¤ë¬´ì—ì„œ java.io.Serializableì„ ì‚¬ìš©í•  ì¼ì´ ë³„ë¡œì—†ìŒ

ë³´í†µ ë‹¨ë…ìœ¼ë¡œì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë¨

### @target, @within

@targetì€ ë¶€ëª¨í´ë˜ìŠ¤ì˜ ë©”ì„œë“œê¹Œì§€ ì–´ë“œë°”ì´ì €ë¥¼ ì ìš©, @withinì€ ìê¸°ìì‹ ì˜ í´ë˜ìŠ¤ì— ì •ì˜ëœ ë©”ì„œë“œì—ë§Œ ì–´ë“œë°”ì´ìŠ¤ë¥¼ ì ìš©

![images](/assets/images/high/Untitled.png)

```java
package hello.aop.pointcut;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;

import hello.aop.member.annotation.ClassAop;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Import({AtTargetAtWithinTest.Config.class})
@SpringBootTest
public class AtTargetAtWithinTest {
	@Autowired
	Child child;

	@ClassAop
	static class Child extends Parent {
		public void childMethod() {}
	}

	static class Parent {
		public void parentMethod() {}
	}

	@Aspect
	static class AtTargetAtWithinAspect {
		//@target : ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ë©”ì„œë“œì˜ ì¡°ì¸í¬ì¸íŠ¸ë¥¼ ì„ ì •, ë¶€ëª¨íƒ€ì…ì˜ ë©”ì„œë“œë„ ì ìš©
		@Around("execution(* hello.aop..*(..)) && @target(hello.aop.member.annotation.ClassAop)")
		public Object atTarget(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[@target] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}

		//within:ì„ íƒëœ í´ë˜ìŠ¤ ë‚´ë¶€ì— ìˆëŠ” ë©”ì„œë“œë§Œ ì¡°ì¸ í¬ì¸íŠ¸ë¡œ ì„ ì •, ë¶€ëª¨íƒ€ì…ì˜ ë©”ì„œë“œëŠ” ì ìš©ë˜ì§€ì•ŠìŒ
		@Around("execution(* hello.aop..*(..)) && @within(hello.aop.member.annotation.ClassAop)")
		public Object atWithin(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[@within] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}
	}

	static class Config {
		@Bean
		public Parent parent() {
			return new Parent();
		}

		@Bean
		public Child child() {
			return new Child();
		}

		@Bean
		public AtTargetAtWithinAspect atTargetAtWithinAspect() {
			return new AtTargetAtWithinAspect();
		}
	}
	@Test
	void success() {
		log.info("child proxy = {}", child.getClass());
		child.childMethod(); //ë¶€ëª¨ ìì‹ ëª¨ë‘ìˆëŠ” ë©”ì„œë“œ
		child.parentMethod(); //ë¶€ëª¨ì—ë§ŒìˆëŠ”ë©”ì„œë“œ
		/*
		* 2024-02-25T14:58:07.861+09:00  INFO 49300 --- [    Test worker] h.aop.pointcut.AtTargetAtWithinTest      : child proxy = class hello.aop.pointcut.AtTargetAtWithinTest$Child$$SpringCGLIB$$0
		2024-02-25T14:58:07.887+09:00  INFO 49300 --- [    Test worker] h.aop.pointcut.AtTargetAtWithinTest      : [@target] void hello.aop.pointcut.AtTargetAtWithinTest$Child.childMethod()
		2024-02-25T14:58:07.889+09:00  INFO 49300 --- [    Test worker] h.aop.pointcut.AtTargetAtWithinTest      : [@within] void hello.aop.pointcut.AtTargetAtWithinTest$Child.childMethod()
		2024-02-25T14:58:07.891+09:00  INFO 49300 --- [    Test worker] h.aop.pointcut.AtTargetAtWithinTest      : [@target] void hello.aop.pointcut.AtTargetAtWithinTest$Parent.parentMethod()
		*/
	}
}
```

ë¡œê·¸ë¥¼ ë³´ë©´ childëŠ” ë¶€ëª¨, ìì‹ ë‘˜ë‹¤ í˜¸ì¶œì´ë˜ê³  parentëŠ” ë¶€ëª¨ë§Œ í˜¸ì¶œë¨ == withinì—ì„œëŠ” AOPê°€ ì ìš©ë˜ì§€ì•ŠìŒ

ì´ê²ƒë„ ë‹¨ë…ìœ¼ë¡œëŠ” ì˜ ì‚¬ìš©í•˜ì§€ì•Šê³  íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì— ì‚¬ìš©ë¨

> [!NOTE]
> ğŸ’¡ args, @args, @targetëŠ” ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ì•ˆëœë‹¤
ìœ„ ì˜ˆì œë¥¼ ë³´ë©´ execution(* hello.aop..*(..)) & & ë¡œ ì ìš©ëŒ€ìƒì˜ ëª¨ìˆ˜ë¥¼ ë¨¼ì € ì¤„ì¸ë‹¤ìŒ í•´ë‹¹ í¬ì¸íŠ¸ì»·ì§€ì‹œìë¥¼ ì‚¬ìš©í–ˆìŒ
ìœ„ì˜ 3ê°€ì§€ ì§€ì‹œìëŠ” ì‹¤ì œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ëœ í›„ ì‹¤í–‰ë ë•Œ ì–´ë“œë°”ì´ìŠ¤ì ìš©ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸°ë•Œë¬¸
ê·¸ëŸ°ë° **ì‹¤í–‰ì‹œì ì— ì¼ì–´ë‚˜ëŠ” í¬ì¸íŠ¸ì»·ì ìš©ì—¬ë¶€ë„ ê²°êµ­ í”„ë¡ì‹œê°€ìˆì–´ì•¼ íŒë‹¨ì´ ê°€ëŠ¥**í•˜ë‹¤
ê·¸ëŸ¬ë‚˜ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ëŠ”ì‹œì ì€ ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆê°€ë§Œë“¤ì–´ì§€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”©ì‹œì ì— ì ìš©ê°€ëŠ¥í•˜ë‹¤. 
ê²°ë¡ ì€ ìœ„ì˜ 3ê°€ì§€ í¬ì¸íŠ¸ì»·ì§€ì‹œìëŠ” ëª¨ë“  ìŠ¤í”„ë§ë¹ˆì— AOPë¥¼ ì ìš©í•˜ë ¤ê³  ì‹œë„í•¨
ë¬¸ì œëŠ” ëª¨ë“  ìŠ¤í”„ë§ë¹ˆì— aopí”„ë¡ì‹œë¥¼ ì ìš©í•˜ë ¤í•˜ë©´ ìŠ¤í”„ë§ì´ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¹ˆ ì¤‘ finalë¡œ ì§€ì •ëœ ë¹ˆë“¤ì—ì„œ ì˜¤ë¥˜ê°€ë°œìƒí•¨!
**ìš”ì•½ : ì‹¤ì œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ë§Œë“¤ì–´ì§€ê³  ì‹¤ì œ ëŸ°íƒ€ì„ì‹œì ì— íŒë‹¨ì´ ê°€ëŠ¥í•œë° í”„ë¡ì‹œê°€ ì—†ìœ¼ë©´ ë¶ˆê°€ëŠ¥í•´ì„œ ìŠ¤í”„ë§ì´ í”„ë¡ì‹œë¥¼ ë§Œë“¤ê³ ë´„. ì´ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•¨** >
>
>ë˜í•œ finalë¡œ ì„ ì–¸ëœ í´ë˜ìŠ¤ëŠ” í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŒ. ë¶€ëª¨-ìì‹ ê´€ê³„ë¥¼ ê°€ì§ˆ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ CGLIB ê°€ Proxy í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ê¸° ë•Œë¬¸

### @annotation, @args

```java
package hello.aop.pointcut;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

import hello.aop.member.MemberService;
import hello.aop.member.MemberServiceImpl;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@SpringBootTest
@Import({AtAnnotationTest.AtAnnotationAspect.class})
public class AtAnnotationTest {
	@Autowired
	MemberService memberService;

	@Test
	void success() {
		log.info("memberService proxy = {}", memberService.getClass());
		memberService.hello("helloA");
	}

	@Aspect
	static class AtAnnotationAspect {
		@Around("@annotation(hello.aop.member.annotation.MethodAop)")
		public Object doAtAnnotation(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[@annoatation]{}",joinPoint.getSignature());
			return joinPoint.proceed();
		}
	}
}

```

@MethodAopê°€ ë¶™ì€ ë©”ì„œë“œë§Œ ìœ„ì˜ ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©ë¨

```java
package hello.aop.member;

import org.springframework.stereotype.Service;

import hello.aop.member.annotation.MethodAop;

@Service
public class MemberServiceImpl implements MemberService {
	@Override
	@MethodAop("test value")
	public String hello(String param) {
		return "OK";
	}

	public String internal(String param) {
		return "OK";
	}
}

```

helloì—ë§Œì ìš©ëœë‹¤ëŠ”ëœ»

### bean

```java
package hello.aop.pointcut;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

import hello.aop.order.OrderService;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Import({BeanTest.BeanAspect.class})
@SpringBootTest
public class BeanTest {
	@Autowired
	OrderService orderService;

	@Test
	void success() {
		orderService.orderItem("itemA");
	}

	@Aspect
	static class BeanAspect {
		@Around("bean(orderService) || bean(*Repository)")
		public Object doLog(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[bean] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}
	}
}

```

ì´ê²ƒë„ ì˜ì•ˆì”€

### ë§¤ê²Œë³€ìˆ˜ ì „ë‹¬

```java
package hello.aop.pointcut;

import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

import hello.aop.member.MemberService;
import hello.aop.member.annotation.ClassAop;
import hello.aop.member.annotation.MethodAop;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@SpringBootTest
@Import({ParameterTest.ParameterAspect.class})
public class ParameterTest {
	@Autowired
	MemberService memberService;

	@Test
	void success() {
		log.info("memberService proxy = {}", memberService.getClass());
		memberService.hello("helloA");
	}

	@Aspect
	static class ParameterAspect {
		@Pointcut("execution(* hello.aop.member..*.*(..))")
		public void allMember() {

		}

		@Around("allMember()")
		public Object logArgs1(ProceedingJoinPoint joinPoint) throws Throwable {
			Object arg1 = joinPoint.getArgs()[0];
			log.info("[logArgs1]{}, arg={}", joinPoint.getSignature(), arg1);
			return joinPoint.proceed();
		}

		@Around("allMember() && args(arg, ..)")
		public Object logArgs2(ProceedingJoinPoint joinPoint, Object arg) throws Throwable {
			log.info("[logArgs1]{}, arg={}", joinPoint.getSignature(), arg);
			return joinPoint.proceed();
		}

		@Before("allMember() && args(arg, ..)")
		public void logArg3(String arg/*string ì•„ë‹ˆë©´ ì‹¤í–‰ì•ˆë¨*/) {
			log.info("[logArgs3] arg={}", arg);
		}

		//í”„ë¡ì‹œì—ì„œêº¼ë‚´ì•¼í• ë•Œ
		@Before("allMember() && this(obj)")
		public void thisArgs(JoinPoint joinPoint, MemberService obj) {
			log.info("[this]{}, obj={}", joinPoint.getSignature(), obj);
		}

		//ì‹¤ì œê°ì²´ì—ì„œêº¼ë‚´ì•¼í• ë•Œ
		@Before("allMember() && target(obj)")
		public void targetArgs(JoinPoint joinPoint, MemberService obj) {
			log.info("[target]{}, obj={}", joinPoint.getSignature(), obj);
		}

		@Before("allMember() && @target(annotation)")
		public void atTarget(JoinPoint joinPoint, ClassAop annotation) {
			log.info("[@target]{}, obj={}", joinPoint.getSignature(), annotation);
		}

		@Before("allMember() && @within(annotation)")
		public void atWithin(JoinPoint joinPoint, ClassAop annotation) {
			log.info("[@within]{}, obj={}", joinPoint.getSignature(), annotation);
		}

		@Before(("allMember() && @annotation(annotation)"))
		public void atAnnotation(JoinPoint joinPoint, MethodAop annotation) {
			log.info("[@annotation]{}, annotationValue={}", joinPoint.getSignature(), annotation);
		}

	}
}

```

- logArgs1 : joinPoint.getArgs()[0] ì™€ ê°™ì´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬ ë°›ëŠ”ë‹¤.
- logArgs2 : args(arg,..) ì™€ ê°™ì´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬ ë°›ëŠ”ë‹¤.
- logArgs3 : @Before ë¥¼ ì‚¬ìš©í•œ ì¶•ì•½ ë²„ì „ì´ë‹¤. ì¶”ê°€ë¡œ íƒ€ì…ì„ String ìœ¼ë¡œ ì œí•œí–ˆë‹¤.
- this : í”„ë¡ì‹œ ê°ì²´ë¥¼ ì „ë‹¬ ë°›ëŠ”ë‹¤.
- target : ì‹¤ì œ ëŒ€ìƒ ê°ì²´ë¥¼ ì „ë‹¬ ë°›ëŠ”ë‹¤.
- @target , @within : íƒ€ì…ì˜ ì• ë…¸í…Œì´ì…˜ì„ ì „ë‹¬ ë°›ëŠ”ë‹¤.
- @annotation : ë©”ì„œë“œì˜ ì• ë…¸í…Œì´ì…˜ì„ ì „ë‹¬ ë°›ëŠ”ë‹¤. ì—¬ê¸°ì„œëŠ” annotation.value()ë¡œ í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ì˜ ê°’ì„ ì¶œë ¥í•˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. (ì œì¼ì“¸ë§Œí•¨)
- ë¡œê·¸
2024-02-25T16:17:41.355+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : memberService proxy = class hello.aop.member.MemberServiceImpl$ $SpringCGLIB$ $0
2024-02-25T16:17:41.371+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : [logArgs1]String hello.aop.member.MemberServiceImpl.hello(String), arg=helloA
2024-02-25T16:17:41.374+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : [logArgs1]String hello.aop.member.MemberServiceImpl.hello(String), arg=helloA
2024-02-25T16:17:41.376+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : [@annotation]String hello.aop.member.MemberServiceImpl.hello(String), annotationValue=@hello.aop.member.annotation.MethodAop("test value")
2024-02-25T16:17:41.394+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : [logArgs3] arg=helloA
2024-02-25T16:17:41.395+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : [target]String hello.aop.member.MemberServiceImpl.hello(String), obj=hello.aop.member.MemberServiceImpl@39851c5
2024-02-25T16:17:41.395+09:00  INFO 65532 --- [    Test worker] hello.aop.pointcut.ParameterTest         : [this]String hello.aop.member.MemberServiceImpl.hello(String), obj=hello.aop.member.MemberServiceImpl@39851c5

### this vs target
<font color="#bfbfbf">ë³„ë¡œ ì•ˆì¤‘ìš”í•˜ë‹¤</font>
<font color="#bfbfbf">ê·¼ë° ì–´ë µë‹¤</font>
<font color="#bfbfbf">ì–´ì©”ê¹Œ</font>
ì¼ë‹¨ * ì‚¬ìš©ëª»í•¨

ìŠ¤í”„ë§ì—ì„œ AOPë¥¼ ì ìš©í•˜ë©´ ì‹¤ì œ targetê°ì²´ëŒ€ì‹  í”„ë¡ì‹œê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤ ê·¸ëŸ¼ ì—¬ê¸°ì„œ

- this : ìŠ¤í”„ë§ë¹ˆìœ¼ë¡œ ë“±ë¡ëœ í”„ë¡ì‹œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í¬ì¸íŠ¸ì»· ë§¤í•‘
- target: ì‹¤ì œ targetê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í¬ì¸íŠ¸ì»·ì„ ë§¤ì¹­

![images](/assets/images/high/Untitled2.png)

- MemberService Interface ì§€ì •
    - this(MemberService) : í”„ë¡ì‹œê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. thisëŠ” ë¶€ëª¨íƒ€ì…ì„ í—ˆìš©í•˜ê¸°ë•Œë¬¸ì— memberService interfaceì—ë„ AOPì ìš©
    - target(MemberService) :  targetê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. targetì€ ë¶€ëª¨íƒ€ì…ì„ í—ˆìš©í•˜ê¸°ë•Œë¬¸ì— memberService interfaceì—ë„ AOPì ìš©
- MemberServiceImpl êµ¬ì²´í´ë˜ìŠ¤ ì§€ì •
    - this(MemberServiceImpl) : proxyê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. JDK ë™ì  í”„ë¡ì‹œë¡œ ë§Œë“¤ì–´ì§„ proxy ê°ì²´ëŠ” MemberService ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ëœ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë‹¤
    â‡’ MemberServiceImplì„ ì•Œì§€ëª»í•´ AOPì ìš©ëŒ€ìƒì´ ì•„ë‹˜
    - target(MemberServiceImpl) : targetê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. AOPì ìš©ëŒ€ìƒì„

![images](/assets/images/high/Untitled3.png)

- MemberService interface ì§€ì •
    - this(MemberService) : proxyê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. thisëŠ” ë¶€ëª¨ë¥¼ í—ˆìš©í•´ì„œ AOP ì ìš©ë¨
    - target(MemberService) : targetê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. targetì€ ë¶€ëª¨ë¥¼ í—ˆìš©í•´ì„œ AOP ì ìš©ë¨
- MemberServiceImpl êµ¬ì²´í´ë˜ìŠ¤ ì§€ì •
    - this(MemberServiceImpl) : proxyê°ì²´ë¥¼ ë³´ê³  íŒë‹¨í•˜ëŠ”ë° CGLIB proxyê°ì²´ê°€ MemberServiceImplì„ ìƒì†ë°›ì•„ ë§Œë“¤ì–´ì ¸ì„œ AOPì ìš©ë¨. thisê°€ ë¶€ëª¨ë¥¼ í—ˆìš©í•´ì„œ í¬ì¸íŠ¸ì»·ì˜ ëŒ€ìƒì„
        - this(MemberServiceImpl) : targetê°ì²´ë¥¼ ë³´ê³  íŒë‹¨. targetê°ì²´ê°€ MemberServiceImplíƒ€ì…ì´ë¼ AOPì ìš© ëŒ€ìƒì„
â‡’ í”„ë¡œì‹œ ëŒ€ìƒì¸ thisëŠ” í”„ë¡ì‹œ ìƒì„±ì „ëµì—ë”°ë¼ ê²°ê³¼ê°€ ë‹¤ë¦„

```java
package hello.aop.pointcut;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;

import hello.aop.member.MemberService;
import hello.aop.member.MemberServiceImpl;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@SpringBootTest
@Import({ThisTargetTest.ThisTargetAspect.class})
public class ThisTargetTest {
	@Autowired
	MemberService memberService;

	@Test
	void success() {
		log.info("memberService Proxy={}", memberService.getClass());
		memberService.hello("helloA");
	}

	@Aspect
	static class ThisTargetAspect {
		//ë¶€ëª¨íƒ€ì…í—ˆìš©
		@Around("this(hello.aop.member.MemberService)")
		public Object doThisInterface(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[this-interface] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}

		//ë¶€ëª¨íƒ€ì…í—ˆìš©
		@Around("target(hello.aop.member.MemberService)")
		public Object doTargetInterface(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[target-interface] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}

		//ë¶€ëª¨íƒ€ì…í—ˆìš©
		@Around("this(hello.aop.member.MemberServiceImpl)")
		public Object doThisClass(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[this-class] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}

		//ë¶€ëª¨íƒ€ì…í—ˆìš©
		@Around("target(hello.aop.member.MemberServiceImpl)")
		public Object doTargetClass(ProceedingJoinPoint joinPoint) throws Throwable {
			log.info("[target-class] {}", joinPoint.getSignature());
			return joinPoint.proceed();
		}
	}
}
```

- JDKí”„ë¡ì‹œ ë¡œê·¸
    2024-02-25T17:19:51.082+09:00  INFO 78071 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : memberService Proxy=class jdk.proxy3.$Proxy63
    2024-02-25T17:19:51.113+09:00  INFO 78071 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [target-class] String hello.aop.member.MemberService.hello(String)
    2024-02-25T17:19:51.116+09:00  INFO 78071 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [target-interface] String hello.aop.member.MemberService.hello(String)
    2024-02-25T17:19:51.119+09:00  INFO 78071 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [this-interface] String hello.aop.member.MemberService.hello(String)
- CGLIB
    2024-02-25T17:21:38.735+09:00  INFO 78414 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : memberService Proxy=class hello.aop.member.MemberServiceImpl$ $SpringCGLIB$ $0
    2024-02-25T17:21:38.751+09:00  INFO 78414 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [target-class] String hello.aop.member.MemberServiceImpl.hello(String)
    2024-02-25T17:21:38.752+09:00  INFO 78414 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [target-interface] String hello.aop.member.MemberServiceImpl.hello(String)
    2024-02-25T17:21:38.752+09:00  INFO 78414 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [this-class] String hello.aop.member.MemberServiceImpl.hello(String)
    2024-02-25T17:21:38.752+09:00  INFO 78414 --- [    Test worker] hello.aop.pointcut.ThisTargetTest        : [this-interface] String hello.aop.member.MemberServiceImpl.hello(String)
    
ì°¸ê³ ë¡œ ìŠ¤í”„ë§ì€ í”„ë¡ì‹œë¥¼ ê¸°ë³¸ìœ¼ë¡œ CGLIBë¥¼ ì‚¬ìš©í•˜ëŠ”ë° 
`spring.aop.proxy-target-class=false` falseë¡œ í•˜ë©´ JDKí”„ë¡ì‹œë¡œ ìƒì„±ë¨

ê¸°ë³¸ê°’ì´ ì™œ CGLIBì¸ì§€ëŠ” ì´í›„ ê°•ì˜ì— ì„¤ëª…