---
title: í™ë©”ëª¨ë¦¬ ì°¨íŠ¸ ë³€í™” ê´€ì°°ê¸°
category: JAVA
tags:
  - java
  - í™ë©”ëª¨ë¦¬
last_modified_at: 2023-05-13
---


>[!ğŸ’¡ ëª©í‘œ]
>
 @ElementCollectionì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ static collectionì— ê°’ì„ ì¶”ê°€, ì‚­ì œí•˜ë©´ì„œ heapë©”ëª¨ë¦¬ ì°¨íŠ¸ê°€ ë³€í™”í•˜ëŠ” ê³¼ì •ì„ ê´€ì°°

### í…ŒìŠ¤íŠ¸ êµ¬ì¡°

```java
package com.dbflixproject.dbfilx.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.ArrayList;
import java.util.List;

@AllArgsConstructor
@NoArgsConstructor
@Entity
@Data
public class TestEntity {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long seq;
    @ElementCollection
    private static List<Integer> list = new ArrayList<>();

    public void addList(Integer num){
        list.add(num);
    }

    public void delList(){
        list.clear();
    }

    public int getListSize(){
        return list.size();
    }

}
```

```java
package com.dbflixproject.dbfilx.api;

import com.dbflixproject.dbfilx.entity.TestEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.ArrayList;
import java.util.List;

@RestController
@RequestMapping("/api/test")
public class TestApiController {
    @GetMapping("/one")
    public String insertCollection(){
        TestEntity test = new TestEntity();

        for(int i=0;i<10000000;i++){
            test.addList(i);
        }
        return "insert";
    }
    @GetMapping("/two")
    public String deleteCollection(){
        TestEntity test = new TestEntity();
        System.out.println(test.getListSize());
        test.delList();
        System.out.println(test.getListSize());
        return "delete";
    }
}
```

entityì•ˆì— static Listë¥¼ ë©¤ë²„ë³€ìˆ˜ë¡œ ë‘ê³  ë°°ì—´ì— ê°’ì„ ì¶”ê°€í•˜ë©° heapë©”ëª¨ë¦¬ ë³€í™”ë¥¼ ê´€ì°°í•  ê²ƒì„
### ê²°ê³¼

#### 1ì°¨ ì‹œë„

- í…ŒìŠ¤íŠ¸ ë°©ë²•
	1. ì¶”ê°€ api í˜¸ì¶œ
	2. ì‚­ì œ api í˜¸ì¶œ
- ê²°ê³¼ ê·¸ë˜í”„

![image](/assets/images/java/IMG-20240927160232-3.png)

10000000ê±´ì„ ì¶”ê°€í•œë’¤ ì‚­ì œí•˜ì˜€ìœ¼ë‚˜ ì¶”ê°€ì‹œì—ë§Œ heap memoryê°€ ì¦ê°€í•˜ê³  ì‚­ì œì‹œì—ëŠ” ìƒê°í•œê²ƒì²˜ëŸ¼ í•˜ë½í•˜ì§€ ì•ŠìŒ.

ì‚­ì œ í›„ ì¼ì • ì‹œê°„ì´ ì§€ë‚œ í›„ì— ê°€ë¹„ì§€ì»¬ë ‰í„°ê°€ ì‘ë™í•˜ëŠ”ê²ƒì¸ì§€ ê¶ê¸ˆí•´ì„œ ì•½ 15ë¶„ë™ì•ˆ ê¸°ë‹¤ë ¤ë³´ì•˜ìœ¼ë‚˜ ìƒê°ì²˜ëŸ¼ í•˜ë½í•˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•¨.

í˜¹ì‹œë‚˜ ì‹¶ì–´ì„œ ì‹­ì–µê±´ì„ listì— ì¶”ê°€í•˜ì java.lang.OutOfMemoryError: Java heap spaceë¼ëŠ” ì—ëŸ¬ê°€ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•¨.

#### 2ì°¨ ì‹œë„
- í…ŒìŠ¤íŠ¸ ë°©ë²•
	1. ì¶”ê°€ api í˜¸ì¶œ
	2. ì‚­ì œ api í˜¸ì¶œ
	3. ì¶”ê°€ api í˜¸ì¶œ
	4. (ë°˜ë³µ)
- ê²°ê³¼ ê·¸ë˜í”„
![image](/assets/images/java/IMG-20240927160232-5.png)

ì²œë§Œê±´ì˜ ë°ì´í„° ì¶”ê°€ì‚­ì œë¥¼ ë°˜ë³µí•˜ì **ì¶”ê°€ ìš”ì²­ì—ì„œ heap ë©”ëª¨ë¦¬ê°€ ì¤„ì–´ë“œëŠ” ê²ƒì„ ë°œê²¬**í•¨.

ì‚­ì œë„ ì•„ë‹Œë° ì™œ ì¶”ê°€ì—ì„œ ë©”ëª¨ë¦¬ê°€ ì¤„ì–´ë“œëŠ”ì§€ ì˜ë¬¸ì ì´ ìƒê¹€

***1ì°¨ ê²°ë¡  : ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” ìƒˆë¡œìš´ ìš”ì²­ì´ ë“¤ì–´ì™”ì„ë•Œ í•œë²ˆì”© ì‘ë™í•˜ëŠ” ê²ƒ ê°™ìŒ***

### ì˜ë¬¸ì 

#### @ElementCollection ì–´ë…¸í…Œì´ì…˜ì´ ì—†ëŠ” static Listì—ë„ ë™ì¼í•œ í˜„ìƒì´ ë‚˜íƒ€ë‚˜ëŠ”ì§€?
    
![image](/assets/images/java/IMG-20240927160233.png)
    
ì‚­ì œì—†ì´ ì¶”ê°€ë¥¼ ë°˜ë³µí–ˆì„ë•Œ OutOfMemoryErrorê°€ ë°œìƒí•˜ê³  ì‚­ì œ í›„ ì¬ìš”ì²­ ì‹œ ë©”ëª¨ë¦¬ê°€ ì¤„ì–´ë“œëŠ” ê²ƒì„ í™•ì¸í•¨
    
ElementCollectionê³¼ëŠ” ìƒê´€ì—†ì´ staticê³¼ ì—°ê´€ì´ ìˆëŠ” ë¬¸ì œë¡œ íŒë‹¨ë¨
    
#### ë©”ì†Œë“œ ë‚´ì—ì„œ Listë¥¼ ì„ ì–¸í•œ í›„ ì¶”ê°€ apië¥¼ ë°˜ë³µì‹¤í–‰í•œë‹¤ë©´ ì–´ë–»ê²Œ ë°˜ì‘í•˜ëŠ”ì§€?
    
```java
@GetMapping("/one")
	public String insertCollection(){
		List<Integer> testList = new ArrayList<>();

		for(int i=0;i<100000000;i++){
			testList.add(i);
		}
		return "insert";
	}
```

![image](/assets/images/java/IMG-20240927160233-1.png)

ë³„ë„ì˜ ì‚­ì œ ì‘ì—… ì—†ì´ë„ ë©”ëª¨ë¦¬ê°€ ì¤„ì–´ë“œëŠ” ê²ƒì„ í™•ì¸í•¨

ê·¸ë ‡ë‹¤ë©´ staticë•Œë¬¸ì— ì´ëŸ° í˜„ìƒì´ ë°œìƒí•˜ëŠ” ê²ƒì¸ì§€ ê¶ê¸ˆí•´ì§
    
#### static Listì—ì„œë„ ë™ì¼í•œ í˜„ìƒì´ ë°œìƒí•˜ëŠ”ì§€?
    
```java
package com.dbflixproject.dbfilx.api;

import com.dbflixproject.dbfilx.entity.TestEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.ArrayList;
import java.util.List;

@RestController
@RequestMapping("/api/test")
public class TestApiController {
	static List<Integer> testList = new ArrayList<>();

	@GetMapping("/one")
	public String insertCollection(){
		for(int i=0;i<100000000;i++){
			testList.add(i);
		}
		return "insert";
	}
	@GetMapping("/two")
	public String deleteCollection(){
		System.out.println(testList.size());
		testList.clear();
		System.out.println(testList.size());
		return "delete";
	}
}
```

![image](/assets/images/java/IMG-20240927160233-2.png)

ë™ì¼í•œ í˜„ìƒì´ ë°œìƒë˜ëŠ” ê²ƒì„ í™•ì¸í•¨
    

***2ì°¨ ê²°ë¡  - ì§€ê¸ˆê¹Œì§€ ì»¬ë ‰ì…˜ì„ ë©”ì†Œë“œ ë‚´ì—ì„œ ì‚¬ìš©ì„ í–ˆê¸°ë•Œë¬¸ì— ë©”ì†Œë“œê°€ ì¢…ë£Œë˜ë©´ ì»¬ë ‰ì…˜ì•ˆì˜ ê°’ë„ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì²­ì†Œí•´ì£¼ì—ˆë˜ê±°ê°™ìŒ. ê·¸ëŸ¬ë‚˜ staticì´ ë¶™ì€ ê³µìš©ë³€ìˆ˜ë¡œ ì»¬ë ‰ì…˜ì„ ì„ ì–¸í•œë‹¤ë©´ ì»¬ë ‰ì…˜ ë‚´ì˜ ê°’ì„ ì§€ì›Œì£¼ì§€ ì•ŠëŠ”ë‹¤ë©´ OutOfMemoryErrorê°€ ìƒëŒ€ì ìœ¼ë¡œ ì‰½ê²Œ ë°œìƒí•˜ëŠ” ê²ƒ ê°™ìŒ***

#### ì „ì—­ë³€ìˆ˜ë¡œ ì»¬ë ‰ì…˜ì„ ì„ ì–¸í•œ ë’¤ ì‚­ì œì—†ì´ ì¶”ê°€ë¥¼ ë°˜ë³µí•˜ë©´ OutOfMemoryErrorê°€ ë°œìƒí•˜ëŠ”ì§€?
    
```java
package com.dbflixproject.dbfilx.api;

import com.dbflixproject.dbfilx.entity.TestEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.ArrayList;
import java.util.List;

@RestController
@RequestMapping("/api/test")
public class TestApiController {
	List<Integer> testList = new ArrayList<>();

	@GetMapping("/one")
	public String insertCollection(){
		for(int i=0;i<100000000;i++){
			testList.add(i);
		}
		return "insert";
	}
	@GetMapping("/two")
	public String deleteCollection(){
		System.out.println(testList.size());
		testList.clear();
		System.out.println(testList.size());
		return "delete";
	}
}
```

![image](/assets/images/java/IMG-20240927160233-3.png)

ì—­ì‹œ ë™ì¼í•œ í˜„ìƒì´ ë°œìƒí•¨. staticì˜ ìœ ë¬´ì™€ëŠ” ìƒê´€ì—†ì´ ì»¬ë ‰ì…˜ì•ˆì˜ ê°’ì´ ë‚¨ì•„ìˆëŠ”ê²ƒì´ ë¬¸ì œì¸ê±°ê°™ìŒ

- ì „ì—­ë³€ìˆ˜ë¡œ entityë¥¼ ì„ ì–¸í•œ í›„ staticì´ ë¶™ì§€ì•Šì€ ì»¬ë ‰ì…˜ ì¶”ê°€ë¥¼ ë°˜ë³µí•œë‹¤ë©´ OutOfMemoryErrorê°€ ë°œìƒí•˜ëŠ”ì§€?
	
	```java
	package com.dbflixproject.dbfilx.entity;
	
	import jakarta.persistence.*;
	import lombok.AllArgsConstructor;
	import lombok.Data;
	import lombok.NoArgsConstructor;
	
	import java.util.ArrayList;
	import java.util.List;
	
	@AllArgsConstructor
	@NoArgsConstructor
	@Entity
	@Data
	public class TestEntity {
		@Id @GeneratedValue(strategy = GenerationType.IDENTITY)
		private Long seq;
		@ElementCollection
		private List<Integer> list = new ArrayList<>();
	
		public void addList(Integer num){
			list.add(num);
		}
	
		public void delList(){
			list.clear();
		}
	
		public int getListSize(){
			return list.size();
		}
	
	}
	```
	
	```java
	package com.dbflixproject.dbfilx.api;
	
	import com.dbflixproject.dbfilx.entity.TestEntity;
	import org.springframework.web.bind.annotation.GetMapping;
	import org.springframework.web.bind.annotation.RequestMapping;
	import org.springframework.web.bind.annotation.RestController;
	
	import java.util.ArrayList;
	import java.util.List;
	
	@RestController
	@RequestMapping("/api/test")
	public class TestApiController {
		TestEntity test = new TestEntity();
		@GetMapping("/one")
		public String insertCollection(){
			for(int i=0;i<100000000;i++){
				test.addList(i);
			}
			return "insert";
		}
		@GetMapping("/two")
		public String deleteCollection(){
			test.delList();
			return "delete";
		}
	}
	```
	
	![image](/assets/images/java/IMG-20240927160233-4.png)
	
	ì—­ì‹œ ë™ì¼í•œ í˜„ìƒì´ ë°œìƒí•¨
        


>[!ìµœì¢… ê²°ë¡ ] 
>1. heap ë©”ëª¨ë¦¬ë¥¼ ì •ë¦¬í•˜ê¸° ìœ„í•´ **ê°€ë¹„ì§€ ì½œë ‰í„°ê°€ ì‹¤í–‰ë˜ëŠ” ì¡°ê±´ì€ heapë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•  ë•Œ**ë¡œ íŒë‹¨ë¨. ì´ë•Œ ì •ë¦¬í•  ë©”ëª¨ë¦¬ê°€ ì—†ë‹¤ë©´ OutOfMemoryErrorê°€ ë°œìƒ
>2. staticë¿ë§Œ ì•„ë‹ˆë¼ ì „ì—­ë³€ìˆ˜ì²˜ëŸ¼ ê°’ì´ ê³„ì† ë‚¨ì•„ìˆëŠ” ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í• ë•ŒëŠ” OutOfMemoryErrorê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì‹ ê²½ì¨ì£¼ì–´ì•¼ í•¨
